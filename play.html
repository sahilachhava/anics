<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/favicon.png">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=1440">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Rubik&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/player.css" />
    <title>Anics - Watch Anime & Movies Online</title>
</head>
<body>
    <div class="video-container">
        
        <video id="mainVideo">
            <source id="videoURL">
            Your browser does not support videos.
        </video>

        <div class="videoLoader">
            <svg version="1.1" id="L9" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve">
                <path fill="#E31221" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
                <animateTransform 
                    attributeName="transform" 
                    attributeType="XML" 
                    type="rotate"
                    dur="1s" 
                    from="0 50 50"
                    to="360 50 50" 
                    repeatCount="indefinite" />
            </path>
            </svg>
        </div>

        <div class="volumeChange">
            <img src="img/icons/volumeFull.png" id="volIcon" />
        </div>

        <div class="controls-container">

            <div class="back-button" id="backButton">
                <i class="fa fa-arrow-left" aria-hidden="true"></i>
            </div>

            <a class="elapsed-time" hidden></a>
            <div class="progress-controls">
                <div class="progress-bar">
                    <div class="watched-bar"></div>
                    <div class="playhead"></div>
                </div>
                <div class="time-remaining">
                    00:00:00
                </div>
            </div>

            <div class="controls">
                <button class="play-pause">
                    <svg class="playing" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <svg class="paused" viewBox="0 0 24 24">
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                </button>

                <button class="rewind">
                    <svg viewBox="0 0 24 24">
                    <path fill="#ffffff"
                        d="M12.5,3C17.15,3 21.08,6.03 22.47,10.22L20.1,11C19.05,7.81 16.04,5.5 12.5,5.5C10.54,5.5 8.77,6.22 7.38,7.38L10,10H3V3L5.6,5.6C7.45,4 9.85,3 12.5,3M10,12V22H8V14H6V12H10M18,14V20C18,21.11 17.11,22 16,22H14A2,2 0 0,1 12,20V14A2,2 0 0,1 14,12H16C17.11,12 18,12.9 18,14M14,14V20H16V14H14Z" />
                    </svg>
                </button>

                <button class="fast-forward">
                    <svg viewBox="0 0 24 24">
                    <path fill="#ffffff"
                        d="M10,12V22H8V14H6V12H10M18,14V20C18,21.11 17.11,22 16,22H14A2,2 0 0,1 12,20V14A2,2 0 0,1 14,12H16C17.11,12 18,12.9 18,14M14,14V20H16V14H14M11.5,3C14.15,3 16.55,4 18.4,5.6L21,3V10H14L16.62,7.38C15.23,6.22 13.46,5.5 11.5,5.5C7.96,5.5 4.95,7.81 3.9,11L1.53,10.22C2.92,6.03 6.85,3 11.5,3Z" />
                    </svg>
                </button>

                <button class="volume">
                    <svg class="full-volume" viewBox="0 0 24 24">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                    <svg class="muted" viewBox="0 0 24 24">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <line x1="23" y1="9" x2="17" y2="15"></line>
                    <line x1="17" y1="9" x2="23" y2="15"></line>
                    </svg>
                </button>

                <p class="title">
                    <span id="episodeName" class="series"><span></span></span> 
                </p>

                <button class="help">
                    <a class="tooltiptext" href="report.html">Something wrong?</a>
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </button>

                <button class="previous" id="prevBtn">
                    <svg viewBox="0 0 24 24" style="transform: rotate(180deg);">
                        <polygon points="5 4 15 12 5 20 5 4"></polygon>
                        <line x1="19" y1="5" x2="19" y2="19"></line>
                    </svg>
                </button>

                <button class="next" id="nextBtn">
                    <svg viewBox="0 0 24 24">
                        <polygon points="5 4 15 12 5 20 5 4"></polygon>
                        <line x1="19" y1="5" x2="19" y2="19"></line>
                    </svg>
                </button>

                <!-- <button class="episodes">
                    <svg viewBox="0 0 24 24">
                    <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                    <polyline points="2 17 12 22 22 17"></polyline>
                    <polyline points="2 12 12 17 22 12"></polyline>
                    </svg>
                </button>

                <button class="captions">
                    <svg viewBox="0 0 20 20">
                    <path
                        d="M17 0H3a3 3 0 00-3 3v10a3 3 0 003 3h11.59l3.7 3.71A1 1 0 0019 20a.84.84 0 00.38-.08A1 1 0 0020 19V3a3 3 0 00-3-3zM3.05 9.13h2a.75.75 0 010 1.5h-2a.75.75 0 110-1.5zm3.89 4.44H3.05a.75.75 0 010-1.5h3.89a.75.75 0 110 1.5zm5 0H10a.75.75 0 010-1.5h2a.75.75 0 010 1.5zm0-2.94H8.08a.75.75 0 010-1.5H12a.75.75 0 010 1.5zm5 0H15a.75.75 0 010-1.5h2a.75.75 0 010 1.5z" />
                    </svg>
                </button>

                <button class="cast">
                    <svg viewBox="0 0 24 24">
                    <path
                        d="M2 16.1A5 5 0 0 1 5.9 20M2 12.05A9 9 0 0 1 9.95 20M2 8V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6">
                    </path>
                    <line x1="2" y1="20" x2="2.01" y2="20"></line>
                    </svg>
                </button> -->
                
                <button class="full-screen">
                    <svg class="maximize" viewBox="0 0 24 24">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
                    </path>
                    </svg>
                    <svg class="minimize" viewBox="0 0 24 24">
                    <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3">
                    </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-storage.js"></script>
    <script src="js/global.js"></script>
    <script src="js/player.js"></script>
    <script src="commander/assets/firebase.js"></script>
</body>
<script>
    const userID = localStorage.getItem("userUID");
    const loginStatus = localStorage.getItem("loginStatus");
    const currentProfile = localStorage.getItem("userProfile");

    if(loginStatus != "1" || userID == null){
        window.location.href = "login.html";
    }else if(currentProfile == null){
        window.location.href = "profiles.html";
    }else{
        const showID = localStorage.getItem('showID');
        const epNo = parseInt(localStorage.getItem('episodeNo'));
        const audioType = localStorage.getItem('episodeAudio');
        const subbedEpisodes = localStorage.getItem('subbedEpisodes').split("},");
        const dubbedEpisodes = localStorage.getItem('dubbedEpisodes').split("},");

        $('#backButton').attr('onclick', 'showDetails(`'+showID+'`)');

        for(var cntr = 0; cntr < subbedEpisodes.length; cntr++){
            if(subbedEpisodes[cntr].substr(subbedEpisodes[cntr].length - 1) != '}'){
                subbedEpisodes[cntr] += '}';
            }
        }
        for(var cntr = 0; cntr < dubbedEpisodes.length; cntr++){
            if(dubbedEpisodes[cntr].substr(dubbedEpisodes[cntr].length - 1) != '}'){
                dubbedEpisodes[cntr] += '}';
            }
        }

        if(audioType == "dub"){
            var currentEpisode = JSON.parse(dubbedEpisodes[epNo]);
            $('#episodeName').html(currentEpisode.show + ' <span>'+currentEpisode.name+'</span>');
            $('#videoURL').attr('src', currentEpisode.url);

            if(epNo != 0){
                $('#prevBtn').attr('onclick', 'playNow('+(epNo-1)+', `dub`);');
            }else{
                $('#prevBtn').attr('hidden', 'true');
            }
            if(epNo < dubbedEpisodes.length - 1){
                $('#nextBtn').attr('onclick', 'playNow('+(epNo+1)+', `dub`);');
            }else{
                $('#nextBtn').attr('hidden', 'true');
            }
        }else{
            var currentEpisode = JSON.parse(subbedEpisodes[epNo]);
            $('#episodeName').html(currentEpisode.show + ' <span>'+currentEpisode.name+'</span>');
            $('#videoURL').attr('src', currentEpisode.url);

            if(epNo != 0){
                $('#prevBtn').attr('onclick', 'playNow('+(epNo-1)+', `sub`);');
            }else{
                $('#prevBtn').attr('hidden', 'true');
            }
            if(epNo < subbedEpisodes.length - 1){
                $('#nextBtn').attr('onclick', 'playNow('+(epNo+1)+', `sub`);');
            }else{
                $('#nextBtn').attr('hidden', 'true');
            }
        }
        document.getElementById("mainVideo").load();
        document.getElementById("mainVideo").play();
    }

    $('.progress-bar').hover(function(e){
        $this = $(this);
        var widthHovered = e.pageX - $this.offset().left;
        var calc = (widthHovered / this.offsetWidth * video.duration);
        $('.elapsed-time').css('margin-left', (widthHovered+12));
        $('.elapsed-time').text(convertTime(calc.toFixed(0)));
        $('.elapsed-time').removeAttr('hidden');
    });

    $('.progress-bar').mouseout(()=>{
        $('.elapsed-time').attr('hidden', 'true');
    });

    function convertTime(totalSeconds) {
        const time = new Date(null);
        time.setUTCSeconds(totalSeconds);
        let hours = null;
        if(totalSeconds >= 3600) {
            hours = (time.getUTCHours().toString()).padStart('2', '0');
        }
        let minutes = (time.getUTCMinutes().toString()).padStart('2', '0');
        let seconds = (time.getUTCSeconds().toString()).padStart('2', '0');
        if(hours){
            return `${hours ? hours : '00'}:${minutes}:${seconds}`;
        }else{
            return `${minutes}:${seconds}`;
        }
    }
</script>
</html>